ğŸ“Œ Planejamento Detalhado do Back-end do Hit
1ï¸âƒ£ ConfiguraÃ§Ã£o do Ambiente de Desenvolvimento
Antes de codar, precisamos configurar um ambiente eficiente para garantir produtividade e organizaÃ§Ã£o.

ğŸ”¹ 1.1 â€“ Criar o RepositÃ³rio e Estruturar o Projeto
âœ… Criar um repositÃ³rio no GitHub/GitLab
âœ… Clonar o repositÃ³rio para a mÃ¡quina local
âœ… Criar a estrutura bÃ¡sica de pastas do projeto

plaintext
Copiar
Editar
hit-backend/
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ utils/
â”‚â”€â”€ tests/
â”‚â”€â”€ .env
â”‚â”€â”€ package.json
â”‚â”€â”€ tsconfig.json (caso use TypeScript)
â”‚â”€â”€ README.md
ğŸ”¹ SugestÃ£o:

Manter a separaÃ§Ã£o entre controllers, services e models para seguir o padrÃ£o MVC (Model-View-Controller).
Criar um README bem estruturado desde o inÃ­cio com informaÃ§Ãµes sobre como rodar o projeto.
ğŸ”¹ 1.2 â€“ Inicializar o Projeto e Instalar DependÃªncias
bash
Copiar
Editar
npm init -y  # Criar package.json
npm install fastify dotenv bcryptjs jsonwebtoken mysql2 zod
npm install nodemon tsx --save-dev
ğŸ”¹ ExplicaÃ§Ã£o das DependÃªncias:

Fastify â€“ Framework web rÃ¡pido e leve.
dotenv â€“ Gerenciar variÃ¡veis de ambiente.
bcryptjs â€“ Criptografar senhas.
jsonwebtoken â€“ Implementar autenticaÃ§Ã£o via JWT.
mysql2 â€“ Conectar ao MySQL.
zod â€“ ValidaÃ§Ã£o de dados.
nodemon â€“ Atualizar automaticamente o servidor durante o desenvolvimento.
tsx â€“ Rodar TypeScript diretamente (caso opte por TypeScript).
ğŸ”¹ 1.3 â€“ Criar o Servidor com Fastify
âœ… Criar um arquivo server.js ou server.ts
âœ… Configurar o Fastify e as rotas bÃ¡sicas
âœ… Implementar o carregamento do .env

javascript
Copiar
Editar
import Fastify from 'fastify';
import dotenv from 'dotenv';

dotenv.config();
const app = Fastify();

app.get('/', async () => {
  return { message: 'API Hit estÃ¡ rodando!' };
});

app.listen({ port: process.env.PORT || 3000 }, () => {
  console.log('Servidor rodando ğŸš€');
});
2ï¸âƒ£ ConfiguraÃ§Ã£o do Banco de Dados (MySQL)
Vamos estruturar o banco de dados, definindo as tabelas e seus relacionamentos.

ğŸ”¹ 2.1 â€“ Criar e Configurar o Banco de Dados
âœ… Criar o banco no MySQL:

sql
Copiar
Editar
CREATE DATABASE hit_chamados;
âœ… Criar a conexÃ£o no cÃ³digo (config/database.js)

javascript
Copiar
Editar
import mysql from 'mysql2/promise';

export const db = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASS,
  database: process.env.DB_NAME,
});
âœ… Criar as tabelas iniciais:

sql
Copiar
Editar
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('cliente', 'tecnico', 'admin') DEFAULT 'cliente',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE chamados (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    status ENUM('aberto', 'em andamento', 'resolvido') DEFAULT 'aberto',
    user_id INT,
    assigned_to INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (assigned_to) REFERENCES users(id)
);
3ï¸âƒ£ ImplementaÃ§Ã£o da AutenticaÃ§Ã£o
Para garantir seguranÃ§a no sistema, vamos implementar registro, login e autenticaÃ§Ã£o JWT.

ğŸ”¹ 3.1 â€“ Criar o ServiÃ§o de UsuÃ¡rio (services/userService.js)
âœ… Criar funÃ§Ãµes para:

Registrar usuÃ¡rio (hash de senha com bcryptjs)
Login (comparaÃ§Ã£o de senha e geraÃ§Ã£o de JWT)
javascript
Copiar
Editar
import { db } from '../config/database.js';
import bcrypt from 'bcryptjs';
import jwt from 'jsonwebtoken';

export async function registerUser(name, email, password, role) {
    const hashedPassword = await bcrypt.hash(password, 10);
    const [result] = await db.query(
        "INSERT INTO users (name, email, password, role) VALUES (?, ?, ?, ?)",
        [name, email, hashedPassword, role]
    );
    return result;
}

export async function loginUser(email, password) {
    const [users] = await db.query("SELECT * FROM users WHERE email = ?", [email]);
    if (users.length === 0) throw new Error("UsuÃ¡rio nÃ£o encontrado");

    const user = users[0];
    const match = await bcrypt.compare(password, user.password);
    if (!match) throw new Error("Senha invÃ¡lida");

    const token = jwt.sign({ id: user.id, role: user.role }, process.env.JWT_SECRET, { expiresIn: '1h' });
    return { token, user };
}
ğŸ”¹ 3.2 â€“ Criar Rotas de AutenticaÃ§Ã£o (routes/authRoutes.js)
âœ… Criar endpoints para login e registro

javascript
Copiar
Editar
import { registerUser, loginUser } from '../services/userService.js';

app.post('/register', async (req, reply) => {
    try {
        const { name, email, password, role } = req.body;
        await registerUser(name, email, password, role);
        return reply.status(201).send({ message: "UsuÃ¡rio registrado!" });
    } catch (error) {
        return reply.status(400).send({ error: error.message });
    }
});

app.post('/login', async (req, reply) => {
    try {
        const { email, password } = req.body;
        const data = await loginUser(email, password);
        return reply.send(data);
    } catch (error) {
        return reply.status(400).send({ error: error.message });
    }
});
ğŸ”¹ 3.3 â€“ Criar Middleware de AutenticaÃ§Ã£o (middlewares/authMiddleware.js)
âœ… Proteger rotas que exigem usuÃ¡rio autenticado

javascript
Copiar
Editar
import jwt from 'jsonwebtoken';

export function authMiddleware(req, reply, done) {
    const token = req.headers.authorization?.split(" ")[1];
    if (!token) return reply.status(401).send({ error: "Acesso negado" });

    try {
        req.user = jwt.verify(token, process.env.JWT_SECRET);
        done();
    } catch {
        return reply.status(403).send({ error: "Token invÃ¡lido" });
    }
}
ğŸš€ PrÃ³ximos Passos
Agora que temos o ambiente configurado, o banco de dados estruturado e a autenticaÃ§Ã£o implementada, podemos seguir para:
âœ… CRUD de Chamados â€“ Criar, listar, atualizar e encerrar chamados.
âœ… Sistema de PermissÃµes â€“ Apenas tÃ©cnicos podem mudar status.
âœ… Painel Administrativo â€“ RelatÃ³rios e gestÃ£o de usuÃ¡rios.

Isso estÃ¡ bem detalhado? Quer que quebre ainda mais alguma parte? ğŸš€